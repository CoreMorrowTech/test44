name: Build and Release

on:
  push:
    tags:
      - 'v*'  # å½“æ¨é€æ ‡ç­¾æ—¶è§¦å‘ï¼Œå¦‚ v1.0.0
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

permissions:
  contents: write  # å…è®¸åˆ›å»º releases å’Œä¸Šä¼ æ–‡ä»¶

jobs:
  build-and-release:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: Install dependencies
      run: npm ci
      
    - name: Build application
      run: npm run build:win
      
    - name: Get version from package.json
      id: package-version
      run: |
        $version = (Get-Content package.json | ConvertFrom-Json).version
        echo "version=$version" >> $env:GITHUB_OUTPUT
        
    - name: Create Release and Upload Assets
      uses: softprops/action-gh-release@v1
      with:
        tag_name: v${{ steps.package-version.outputs.version }}
        name: Version ${{ steps.package-version.outputs.version }}
        body: |
          ## ğŸš€ ç‰ˆæœ¬ ${{ steps.package-version.outputs.version }} æ›´æ–°å†…å®¹
          
          - âœ¨ æ–°åŠŸèƒ½å’Œæ”¹è¿›
          - ğŸ› Bugä¿®å¤å’Œä¼˜åŒ–
          - ğŸ“¦ è‡ªåŠ¨æ„å»ºå‘å¸ƒ
          
          ## ğŸ“¥ å®‰è£…è¯´æ˜
          
          1. ä¸‹è½½ä¸‹æ–¹çš„ `CodeLinear-Setup-${{ steps.package-version.outputs.version }}.exe` æ–‡ä»¶
          2. è¿è¡Œå®‰è£…ç¨‹åº
          3. æŒ‰ç…§æç¤ºå®Œæˆå®‰è£…
          
          ## ğŸ“‹ ç³»ç»Ÿè¦æ±‚
          
          - Windows 10 æˆ–æ›´é«˜ç‰ˆæœ¬
          - 64ä½ç³»ç»Ÿ
          
          ---
          
          **æ„å»ºæ—¶é—´**: ${{ github.event.head_commit.timestamp }}  
          **æäº¤**: ${{ github.sha }}
        draft: false
        prerelease: false
        files: |
          ./dist/æˆ‘çš„Electronåº”ç”¨ Setup ${{ steps.package-version.outputs.version }}.exe
        token: ${{ secrets.GITHUB_TOKEN }}
      env:
        GH_TOKEN: ${{ github.token }}  # å†…ç½®ä»¤ç‰Œ